<!DOCTYPE html>
<html lang="en">

<head>
  <title>Template</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- External sources -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-log-component/dist/aframe-log-component.min.js"></script>
  <script src="https://unpkg.com/@tweenjs/tween.js@^20.0.0/dist/tween.umd.js"></script>

  <!-- Internal sources -->
  <script src="Scripts/clickable.js"></script>
  <script src="Scripts/game-state.js"></script>
  <script src="Scripts/GameStates.js"></script>
  <script src="Scripts/main-camera.js"></script>
  <script src="Scripts/text-field.js"></script>
  <script src="Scripts/mouse-reaction.js"></script>
  <script src="Scripts/ui-text-popup.js"></script>
  <script src="Scripts/handle-dragging.js"></script>

  <script>
    function setState(state) {
      document.getElementById('scene').components['game-state'].setState(state);
    };

    document.addEventListener('DOMContentLoaded', function () {
      const rig = document.querySelector('#rig');
      const camera = document.querySelector('#mainCamera');
      const isMobile = AFRAME.utils.device.isMobile();

      const resetCameraRotation = () => {
        rig.setAttribute('rotation', { x: 0, y: 0, z: 0 });
        camera.setAttribute('rotation', { x: 0, y: 0, z: 0 });
        camera.components['look-controls'].pitchObject.rotation.set(0, 0, 0);
        camera.components['look-controls'].yawObject.rotation.set(0, 0, 0);
      };

      if (isMobile) {
        document.querySelectorAll('[clickable]').forEach(entity => {
          entity.addEventListener('click', function () {
            resetCameraRotation();
            camera.setAttribute('look-controls', 'enabled', true);
          });
        });

        camera.setAttribute('look-controls', 'enabled', false);
      } else {
        camera.setAttribute('look-controls', 'enabled', true);
      }
    });

    window.addEventListener('load', () => {
      updateLayout();
      const isMobile = AFRAME.utils.device.isMobile();
      document.getElementById('mainCamera').setAttribute('look-controls', isMobile ? 'enabled: false' : 'enabled: true');
    });

    window.addEventListener('resize', updateLayout);

    function onControlVRMode() {
      var cameraEl = document.getElementById('mainCamera');
      if (cameraEl) {
        var lookControls = cameraEl.getAttribute('look-controls');
        cameraEl.setAttribute('look-controls', 'enabled', !lookControls.enabled);

        // Reset the gyroscope and camera rotation
        resetGyroscopeZeroPoint(cameraEl);

        var initialRotation = cameraEl.getAttribute('rotation');
        cameraEl.setAttribute('rotation', initialRotation);
      } else {
        console.error('mainCamera element not found');
      }
    }

    function resetGyroscopeZeroPoint(cameraEl) {
      cameraEl.setAttribute('rotation', '0 0 0');

      var lookControlsComponent = cameraEl.components['look-controls'];
      if (lookControlsComponent) {
        lookControlsComponent.pitchObject.rotation.set(0, 0, 0);
        lookControlsComponent.yawObject.rotation.set(0, 0, 0);
      }
    }

    function toggleMenu() {
      var container = document.getElementById('button-container');
      var visibility = container.style.visibility;
      container.style.visibility = (visibility === 'visible') ? 'hidden' : 'visible';
    }

    function updateLayout() {
      const isMobile = window.innerWidth <= 800; // Assuming 800px as a breakpoint
      const positions = {
        desktop: {
          'Contact': '-2.5 3.2 2.3',
          'Team': '-2.5 1.5 2.3',
          'About': '2.5 3.2 2.3',
          'Products': '2.5 1.5 2.3'
        },
        mobile: {
          'Contact': '-0.7 4.5 2.3',
          'Team': '-0.7 -0.3 2.3',
          'About': '0.7 4.5 2.3',
          'Products': '0.7 -0.3 2.3'
        }
      };

      // Choose the set of positions based on whether it's mobile or desktop
      const chosenPositions = isMobile ? positions.mobile : positions.desktop;

      // Update the positions of each entity
      for (const id in chosenPositions) {
        const entity = document.getElementById(id);
        if (entity) {
          entity.setAttribute('position', chosenPositions[id]);
        }
      }
    }
  </script>

  <style>
    #button-container {
      position: fixed;
      top: 40px;
      right: 10px;
      z-index: 1;
      display: flex;
      flex-direction: column;
      visibility: hidden;
    }

    #menu-button {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 2;
    }

    #overlay {
      display: none;
      /* This make it initially hidden                                           */
      position: fixed;
      /* This makes it so it says in a fixed position even if they scroll around */
      left: 0px;
      /* This positions the element to the left most position                    */
      top: 0px;
      /* This positions the elment to the top most position                      */
      width: 100%;
      /* This makes the element take up 100% of the parents width                */
      height: 100%;
      /* This makes the element take up 100% of the parents height               */
      background: #000;
      /* Give it a black background                                              */
      opacity: 0.5;
      /* Change the opacity to 50% so that is see through.                       */
      z-index: 99999;
      /* Change the z-index so it will be above everything else                  */
    }

    #product-1-popup {
      display: none;
      position: fixed;
      left: 50%;
      /* left and top here position top left page                                        */
      top: 50%;
      /* of the element to the center of the                                             */
      width: 300px;
      /* Set the popup to have a specific width/height                                   */
      height: 150px;
      margin-top: -75px;
      /* To get the popup to center correctly we need                                    */
      margin-left: -150px;
      /* To displace the the top/left margins by half of the width/height                */
      background: #FFFFFF;
      /* Background of white                                                             */
      border: 2px solid #000;
      /* And give it a border                                                            */
      z-index: 100000;
      /* Set z-index to 1 more than that of the overlay so the popup is over the overlay */
    }

    #lock-button {
      display: flex;
      position: fixed;
      visibility: visible;
      left: 10px;
      bottom: 10px;
      z-index: 1;
    }
  </style>
</head>

<body>
  <button id="menu-button" onclick="toggleMenu()">Menu</button>

  <div id="button-container">
    <button onclick="setState('Home')">Home</button>
    <button onclick="setState('Team')">Team</button>
    <button onclick="setState('Contact')">Contact</button>
    <button onclick="setState('Products')">Product</button>
  </div>

  <div id="product-1-popup">
    Here add some amount of text that should be easily readable on any device. The formatting should ideally be handled
    by the element itself.
  </div>
  <div id="overlay"></div>

  <div id="lock-button">
    <button onclick="onControlVRMode()">TransformVRMode</button>
  </div>

  <a-scene id="scene" cursor="rayOrigin: mouse" game-state raycaster="objects: [data-raycastable]"
    background="color: #b4cdc2" obb-collider="showColliders: false">
    <a-assets>
      <a-asset-item id="karton-model" src="Models/23-10-16_DM_house-model-karton_V01.glb"></a-asset-item>
    </a-assets>
    <a-entity scale="10 10 10" position="0 0 0" rotation="0 -70 0" gltf-model="#karton-model"></a-entity>

    <!-- DEBUG LOG [keep] -->
    <!-- <a-log position="6.5 0 -4.5" scale="10 10 10" rotation="0 -10 0" max="1"></a-log> -->

    <!--camera animation-->
    <a-entity id="rig">
      <a-entity id="mainCameraWrapper" position="0 0.5 6" main-camera wasd-controls="acceleration:100">
        <a-camera id="mainCamera" look-controls-enabled="false" custom-look-controls></a-camera>
      </a-entity>
    </a-entity>

    <!-- About 3D button-->
    <a-entity id='About' text="value: About; color: #000; align: center; width: 3"
      geometry="primitive: plane; height: 0.5" material="color: #FFF" scale="1 1 1" clickable mouse-reaction
      data-raycastable>
    </a-entity>

    <!-- About-TextField. Should appear when about button is clicked -->
    <a-entity id='About-Textfield'
      text="value: About-Text\n A brief summary of\n what we do and why; color: #000; align: center; width: 3"
      geometry="primitive: plane; height: 2; width: 2.5" material="color: #FFF" position="0 2.35 2.3" scale="1 1 1"
      visible="true" text-field>
    </a-entity>

    <!-- Team 3D button-->
    <a-entity id='Team' text="value: Team; color: #000; align: center; width: 3"
      geometry="primitive: plane; height: 0.5" material="color: #FFF" scale="1 1 1" clickable mouse-reaction
      data-raycastable>
    </a-entity>

    <!-- Maxx-TextField -->
    <a-entity id='About-Maxx'
      text="value: Maxx-Text\n A brief summary of\n Maxx' persona; color: #000; align: center; width: 0.7"
      geometry="primitive: plane; height: 0.6; width: 0.3" material="color: #FFF" position="-1 2.6 -0.9"
      rotation="0 -70 0" scale="1 1 1" visible="true" text-field>
    </a-entity>

    <!-- Anna-TextField -->
    <a-entity id='About-Anna'
      text="value: Anna-Text\n A brief summary of\n Anna's persona; color: #000; align: center; width: 0.7"
      geometry="primitive: plane; height: 0.6; width: 0.3" material="color: #FFF" position="-1.35 2.6 -1.9"
      rotation="0 -70 0" scale="1 1 1" visible="true" text-field>
    </a-entity>

    <!-- Contact 3D button-->
    <a-entity id='Contact' text="value: Contact; color: #000; align: center; width: 3"
      geometry="primitive: plane; height: 0.5" material="color: #FFF" scale="1 1 1" clickable mouse-reaction
      data-raycastable>
    </a-entity>

    <!-- Contact-TextField. Should appear when contact button is clicked -->
    <a-entity id='Contact-Textfield'
      text="value: short statement\n to facilitate contact; color: #000; align: center; width: 1"
      geometry="primitive: plane; height: 0.12; width: 0.5" material="color: #FFF" position="-0.5 4.55 1.3"
      rotation="0 -30 0" scale="1 1 1" visible="false" text-field>
    </a-entity>

    <!-- e-mail textfield. This will be a link -->
    <a-entity id='Mail-Textfield' class="Raycastable" text="value: e-mail link; color: #000; align: center; width: 1"
      geometry="primitive: plane; height: 0.08; width: 0.5" material="color: #FFF" position="-0.5 4.39 1.3"
      rotation="0 -30 0" scale="1 1 1" visible="false" text-field click-listener="action: email">
    </a-entity>

    <!-- telephone textfield. This will be a link -->
    <a-entity id='Telephone-Textfield' class="Raycastable"
      text="value: telephone-number link; color: #000; align: center; width: 1"
      geometry="primitive: plane; height: 0.08; width: 0.5" material="color: #FFF" position="-0.5 4.3 1.3"
      rotation="0 -30 0" scale="1 1 1" visible="false" text-field click-listener="action: call">
    </a-entity>

    <!-- Products 3D button-->
    <a-entity id='Products' text="value: Products; color: #000; align: center; width: 3"
      geometry="primitive: plane; height: 0.5" material="color: #FFF" scale="1 1 1" clickable mouse-reaction
      data-raycastable>
    </a-entity>

    <!-- Product-Buttons. They name the displayed products and will open a description textfield on click -->
    <a-entity id='Product-1' class="Raycastable" text="value: Product 1; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0 1.5 1.5" rotation="0 20 0"
      scale="1 1 1" visible="true" text-field ui-text-popup="popupId: product-1-popup" mouse-reaction>
    </a-entity>

    <a-entity id='Product-2' class="Raycastable" text="value: Product 2; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0.3 1.5 1.35"
      rotation="0 20 0" scale="1 1 1" visible="true" clickable mouse-reaction text-field>
    </a-entity>

    <a-entity id='Product-3' class="Raycastable" text="value: Product 3; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0.6 1.5 1.20"
      rotation="0 20 0" scale="1 1 1" visible="true" clickable mouse-reaction text-field>
    </a-entity>

    <a-entity id='Product-4' class="Raycastable" text="value: Product 4; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0.9 1.5 1.05"
      rotation="0 20 0" scale="1 1 1" visible="true" clickable mouse-reaction text-field>
    </a-entity>

    <!-- locked products -->
    <a-entity id='LockedProduct-1' class="Raycastable"
      text="value: locked Product 1; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0 1.3 1.5" rotation="0 20 0"
      scale="1 1 1" visible="true" clickable mouse-reaction text-field>
    </a-entity>

    <a-entity id='LockedProduct-2' class="Raycastable"
      text="value: locked Product 2; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0.3 1.3 1.35"
      rotation="0 20 0" scale="1 1 1" visible="true" clickable mouse-reaction text-field>
    </a-entity>

    <a-entity id='LockedProduct-3' class="Raycastable"
      text="value: locked Product 3; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0.6 1.3 1.20"
      rotation="0 20 0" scale="1 1 1" visible="true" clickable mouse-reaction text-field>
    </a-entity>

    <a-entity id='LockedProduct-4' class="Raycastable"
      text="value: locked Product 4; color: #000; align: center; width: 0.5"
      geometry="primitive: plane; height: 0.1; width: 0.2" material="color: #FFF" position="0.9 1.3 1.05"
      rotation="0 20 0" scale="1 1 1" visible="true" clickable mouse-reaction text-field>
    </a-entity>
  </a-scene>
</body>

</html>